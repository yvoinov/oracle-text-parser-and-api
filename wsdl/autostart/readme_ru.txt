============================================================
Autostart OC4J & Solaris 10 SMF   (C) 2006,2009, Yuri Voinov
============================================================

Данный     набор     скриптов    позволяет    активизировать
и  деактивировать  автоматический  запуск и останов сервисов
Oracle OC4J в одно действие на следующих системах:

- Solaris 8,9
- Solaris 10 и выше.
- Linux (RHEL3, RHEL4, SuSE, Fedora, 
         Oracle Enterprise Linux)

Для включения автостарта сервисов Oracle используется скрипт
init.oc4j .     В  зависимости  от платформы (Solaris 8-10),
создаются    либо   ссылки   в   каталоге   /etc/rc3.d, либо
производится  регистрация сервиса и создание ссылок командой
chkconfig  (Linux  RHEL3/4)  либо  производится  регистрация
сервиса в службе SMF.

Данная     служба     предназначена для использования на Sun
Solaris  8,9,10,>10 или на платформах  Linux  (тестировалась
на Solaris и RHEL3/4). Распознавание платформы  производится
автоматически.

Для   установки   скрипта   (-ов)   и/или   создания  ссылок
и  регистрации  дескриптора  сервисов,  используются  скрипт
install.sh   .   Перед  его  запуском  необходимо  проверить
и    отредактировать    переменные    скрипта    init.oracle
в  зависимости  от  конфигурации  сервисов  целевого  хоста.
Разумеется, скрипты install.sh/remove.sh  должны запускаться
от аккаунта root.

Редактируются следующие переменные:

#
# ORA_HOME variable for Standalone OC4J.
# This is substitution variable for legal
# ORACLE_HOME variable below.
# DO NOT RENAME THIS VARIABLE!!
ORA_HOME="/export/home/OraHome3"

#
# Log file. Default /var/adm/oc4j.log
#
LOG="/var/log/oc4j.log"

После  редактирования  переменных необходимо также проверить
файл  oracle.xml  (При  установке автозапуска на Solaris 10)
и при необходимости отредактировать пути.

Для  установки  сервисов  необходимо  распаковать  следующие
файлы:

init.oc4j            - главный старт-стопный скрипт OC4J
oracle.xml           - дескриптор сервисов OC4J для OMF
install.sh           - Скрипт установки автостарта
remove.sh            - Скрипт удаления автостарта

в   необходимый  каталог  и  выполнить  с  правами  аккаунта
root    скрипт   install.sh.   После   его   завершения  все
необходимые   файловые  структуры   будут  созданы  и  можно
выполнить   активацию   сервиса   либо   перезапустив   хост
(Solaris 8,9, Linux) либо выполнив команду (Solaris 10):

# svcadm enable oc4j

контролируя запуск сервисов в отдельной сессии:

# tail -f /var/log/oc4j.log 

(путь   и  имя  лога  могут  быть  другими  и  настраиваются
в скрипте init.oc4j параметром LOG)

Для  остановки  и  удаления  автостарта  необходимо  сделать
следующее:

- Для Solaris 8,9, Linux:
1. Остановить сервисы Oracle вручную;
2. Выполнить  с  правами  root  скрипт remove.sh  из данного
архива

- Для Solaris 10 и выше:
1. Выполнить команду:
# svcadm disable oracle
2. Выполнить с правами root скрипт remove.sh из данного 
   архива.

Для Солярис 10 и выше запуск/останов/перезапуск  служб  oc4j
выполняется  через административный интерфейс OMF (командами
svcadm/svcs).  ДЛя  контроля  состояния сервисов и процессов
запуска   используется  как  основной  лог  запуска/останова
(/var/log/oc4j.log   по   умолчанию), так и собственные логи
сервисов OC4J. Кроме того, и для Solaris 10 и для предыдущих
версий   операции   запуска/останова   могут  быть выполнены
непосредственным   вызовом   скрипта   /etc/init.d/init.oc4j
{start|stop|restart}  (при  выполнении  данных  операций  на
Solaris   10   необходимо  предварительно отключить   сервис
OC4J   при   помощи  интерфейса  OMF, в   противном   случае
рестартер   OMF   будет  перезапускать остановленные вручную
сервисы без предупреждения).

Замечания: 
==========

1.Скрипты установки/удаления автостарта используют несколько
допущений и подчиняются определенным правилам, а именно:
-   Предполагается,   что  OC4J  установлен по рекомендациям
Oracle  Installation  Guide  и  использует  группу DBA. Если
группа  DBA  отсутствует,в ОС Solaris 8,9 и Linux происходит
выход   с   ошибкой  и кодом возврата 1 (например, если OC4J
установлен   с   группой   oinstall - ошибкой это в принципе
не   является,    но    может  послужить  источником  трудно
обнаружимых  ошибок   при  использовании OHS-сервисов и iAS.
Причем  данное  поведение  плохо документировано - и поэтому
не   рекомендуется   нарушать    канонические   рекомендации
и устанавливать OC4J с группой, отличной от dba).
-  Предполагается (либо проверяется),  что  они  выполняются
в    режиме   выполнения  (run  level)  multi-user  (3).   В
противном    случае  доступ  ко  многим  системным  командам
и  сервисам невозможен  и выполнение скриптов будет прервано
с ошибкой.
-  Уровень  выполнения скрипта (-ов) автоматического запуска
не  ниже  3  (то есть в signle user попыток запуска сервисов
OC4J НЕ ПРОИЗВОДИТСЯ).
-  Предполагается,  что  администратор,  выполняющий  данные
скрипты  установки/удаления,  запускает их с правами root.
Если  это  не так, выполнение прерывается с ошибкой и кодом
возврата 1.
-    Предполагается,    что   перед   выполнением   скриптов
установки/удаления   системный   администратор/администратор
базы  данных  выполнил  остановку  сервисов  OC4J вручную.
Проверка   на   выполнение   сервисов не производится. Также
не     производится    никаких    автоматических    операций
запуска/останова      (Solaris      8,9,      Linux)     или
активизации/деактивации  сервисов  Oracle  (для Solaris 10).
Запуск  сервисов  после  установки  автостарта также  должен
быть     выполнен     вручную     командами    svcadm    или
/etc/init.oracle start
-   Для   Linux  RHEL  3/4  при останове хоста командой init
0/init  5  остановка системных сервисов выполняется командой
kill.   Это   приводит   к   аварийному  прекращению  работы
экземпляра   Oracle  и  последующий  запуск  сервисов  может
потребовать существенно более длительного времени вследствие
выполнения  автоматического восстановления сервисов.
============================================================
Autostart OC4J & Solaris 10 SMF   (C) 2006,2009, Yuri Voinov
============================================================